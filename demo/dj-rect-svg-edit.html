<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>图形编辑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #wrapper {
            margin: 40px;
            transform: rotate(0deg);
        }

    </style>
</head>

<body>
    <div id="wrapper">
    </div>

    <script>
        function createShape(){
            
        }
        class MyShape {
            constructor(shapeData){
                this.shapeData = shapeData;
                this.svgW = shapeData.svgW ? shapeData.svgW : 0;
                this.svgH = shapeData.svgH ? shapeData.svgH : 0; 
                this.svgBg = shapeData.svgBg ? shapeData.svgBg : 0;
                this.x = shapeData.shapeX ? shapeData.shapeX : 0;
                this.y = shapeData.shapeY ? shapeData.shapeY : 0;
                this.w = shapeData.shapeW ? shapeData.shapeW : 0;
                this.h = shapeData.shapeH ? shapeData.shapeH : 0;
                this.wrapper = shapeData.wrapper ? shapeData.wrapper : 0;
                this.shapeType = shapeData.shapeType ? shapeData.shapeType : 0;
                this.fill = shapeData.fill ? shapeData.fill : 0;
                this.d = shapeData.d ? shapeData.d :0;
                this.editPoint = shapeData.editPoint ? shapeData.editPoint : [];
                this.stroke = shapeData.stroke ? shapeData.stroke : '';
                
                this.createSvg();
                this.mouseMove = this.mouseMove.bind(this);
                this.point1 = document.getElementById('point1');
                this.point2 = document.getElementById('point2');
                document.getElementById('point1').onmousedown =  (e) => {
                    this.points = 'point1';
                    this.mouseDown(e)
                }
                document.getElementById('point2').onmousedown = (e) => {
                    this.points = 'point2';
                    this.mouseDown(e)
                } 
               
            }
            mouseDown (e) {
                var e = e || window.event;
                document.addEventListener('mousemove', this.mouseMove, false);
                document.addEventListener('mouseup', ()=>{
                    document.removeEventListener('mousemove', this.mouseMove, false);
                });
            }
            // 鼠標移動
            mouseMove (e) {
                let left = document.getElementById('wrapper').offsetLeft;
                if (this.points === 'point1') {
                    this.point1.setAttribute('cx', e.clientX-left) ;
                } else {
                    this.point2.setAttribute('cx', e.clientX-left) ;
                }
            }
            // 變形
            transShape () {

            }
            // 創建svg
            createSvg () {
                const {svgW, svgH, shapeType, wrapper, svgBg} = this;
                const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                svg.setAttribute("width", svgW);
                svg.setAttribute("height", svgH);
                svg.setAttribute("style", `background-color:${svgBg}`);
                const shape = this[`create${shapeType}`]();
               
                svg.appendChild(shape);
                this.editPoint.forEach((item)=>{
                    this[item.id] = item;
                   let point =  this.createPoint(item);
                   svg.appendChild(point);
                })
                document.getElementById(wrapper).appendChild(svg);
            }
            // 創建矩形
            createrect () {
                const {x, y, w, h, shapeType,stroke, fill} = this;
                const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.setAttribute("x", x);
                rect.setAttribute("y", y);
                rect.setAttribute("width", w);
                rect.setAttribute("height", h);
                rect.setAttribute("fill", fill);
                return rect;
            }
            // 創建路徑
            createpath () {
                const {stroke, fill , d } = this;
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute('stroke', stroke);
                path.setAttribute('fill', fill);
                path.setAttribute('d', d);
                return path;
            }
            createPoint (point) {
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute('cx', point.cx);
                circle.setAttribute('cy', point.cy);
                circle.setAttribute('id', point.id);
                circle.setAttribute('r', 2);
                circle.setAttribute('fill', 'red');
                return circle;
            }
        }
        new MyShape({
            wrapper:'wrapper',
            svgW:90,
            svgH:90,
            svgBg:'#eee',
            stroke:'#1380BF',
            fill:'#1AABFF',
            d:'M2.4,2.4   L25.1860281,2.4    L29.6,6.81397186    L29.6,29.6    L6.81397186,29.6    L2.4,25.1860281    L2.4,2.4   Z',
            // d:'M2.4,2.4 L25.1860281,2.4 L29.6,6.81397186 L29.6,29.6 L6.81397186,29.6 L2.4,25.1860281 L2.4,2.4 Z',
            shapeType:'path',
            editPoint:[
                {id:'point1',cx:2.4,cy:2.4},
                {id:'point2',cx:20,cy:2.4}
            ]
        });
    </script>
</body>

</html>
